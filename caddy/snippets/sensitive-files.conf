# ============================================================================
# sensitive-files.conf - 敏感文件访问防护配置
# ============================================================================
#
# 功能描述:
# - 阻止对敏感文件和目录的访问
# - 防止信息泄露和目录遍历攻击
# - 返回 403 Forbidden 状态码
# - 适用于所有 Web 应用的安全防护
#
# 使用方法:
# 在站点配置中添加: import ../snippets/sensitive-files.conf
# ============================================================================

# 定义敏感路径匹配器
@deny_sensitive {
	# Git 相关文件
	path /.git/*
	path /.gitignore
	path /.gitattributes
	path /.gitmodules

	# 环境配置文件
	path /.env*
	path /.env
	path /.env.local
	path /.env.production
	path /.env.development
	path /.env.testing

	# 应用配置文件
	path /composer.json
	path /composer.lock
	path /package.json
	path /package-lock.json
	path /yarn.lock
	path /pnpm-lock.yaml
	path /bower.json

	# 框架特定文件
	path /artisan
	path /server.php
	path /index.php
	path /wp-config.php
	path /wp-config-sample.php
	path /wp-admin/install.php
	path /wp-includes/version.php

	# 数据库和备份文件
	path *.sql
	path *.sql.gz
	path *.sql.bak
	path *.bak
	path *.old
	path *.backup
	path /backup/*
	path /database/*

	# 日志文件
	path *.log
	path /logs/*
	path /storage/logs/*
	path /var/log/*

	# 临时和缓存文件
	path *~
	path *.tmp
	path *.temp
	path /tmp/*
	path /cache/*
	path /storage/framework/cache/*
	path /storage/framework/sessions/*
	path /storage/framework/views/*

	# IDE 和编辑器文件
	path /.idea/*
	path /.vscode/*
	path /.vs/*
	path /.project
	path /.settings/*
	path /.buildpath
	path /.classpath

	# 系统文件
	path /.htaccess
	path /web.config
	path /nginx.conf
	path /apache2.conf
	path /httpd.conf

	# 证书和密钥文件
	path *.pem
	path *.key
	path *.crt
	path *.cer
	path *.pfx
	path /ssl/*
	path /certificates/*

	# 源代码和文档
	path /src/*
	path /app/*
	path /config/*
	path /routes/*
	path /README*
	path /CHANGELOG*
	path /LICENSE*

	# 隐藏文件
	path /.*

	# 常见攻击路径
	path /admin/*
	path /administrator/*
	path /phpmyadmin/*
	path /mysql/*
	path /db/*
	path /database/*
	path /backup/*
	path /uploads/*

	# 开发工具路径
	path /_ignition/*
	path /debug/*
	path /phpinfo*
	path /test*
	path /demo*
}

handle @deny_sensitive {
	respond "Access Denied" 403
}

# 处理敏感文件访问
#handle @deny_sensitive {
#	# 返回 403 Forbidden
#	respond "Access Denied" 403
#
#	# 移除可能由其他配置设置的通用安全头
#	header -X-Frame-Options
#	header -Content-Security-Policy
#	header -Cache-Control
#
#	# 设置敏感文件特有的严格安全头
#	header X-Frame-Options "DENY"
#	header Content-Security-Policy "default-src 'none'"
#	header Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
#
#	# 移除服务器标识信息
#	header -Server
#	header -X-Powered-By
#	header -Via
#}
