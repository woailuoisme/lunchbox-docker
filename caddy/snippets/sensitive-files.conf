# ============================================================================
# sensitive-files.conf - 敏感文件访问防护配置
# ============================================================================
#
# 功能描述:
# - 阻止对敏感文件和目录的访问
# - 防止信息泄露和目录遍历攻击
# - 返回 403 Forbidden 状态码
# - 适用于所有 Web 应用的安全防护
# ============================================================================

# 定义敏感路径匹配器
@deny_sensitive {
    # Git 相关文件
    path /.git/*
    path /.gitignore
    path /.gitattributes
    path /.gitmodules

    # 环境配置文件
    path /.env*
    path /.env
    path /.env.local
    path /.env.production
    path /.env.development
    path /.env.testing

    # 应用配置文件
    path /composer.json
    path /composer.lock
    path /package.json
    path /package-lock.json
    path /yarn.lock
    path /pnpm-lock.yaml
    path /bower.json

    # 框架特定文件
    path /artisan
    path /server.php
    path /index.php
    path /wp-config.php
    path /wp-config-sample.php
    path /wp-admin/install.php
    path /wp-includes/version.php

    # 数据库和备份文件
    path *.sql
    path *.sql.gz
    path *.sql.bak
    path *.bak
    path *.old
    path *.backup
    path /backup/*
    path /database/*

    # 日志文件
    path *.log
    path /logs/*
    path /storage/logs/*
    path /var/log/*

    # 临时和缓存文件
    path *~
    path *.tmp
    path *.temp
    path /tmp/*
    path /cache/*
    path /storage/framework/cache/*
    path /storage/framework/sessions/*
    path /storage/framework/views/*

    # IDE 和编辑器文件
    path /.idea/*
    path /.vscode/*
    path /.vs/*
    path /.project
    path /.settings/*
    path /.buildpath
    path /.classpath

    # 系统文件
    path /.htaccess
    path /web.config
    path /nginx.conf
    path /apache2.conf
    path /httpd.conf

    # 证书和密钥文件
    path *.pem
    path *.key
    path *.crt
    path *.cer
    path *.pfx
    path /ssl/*
    path /certificates/*

    # 源代码和文档
    path /src/*
    path /app/*
    path /config/*
    path /routes/*
    path /README*
    path /CHANGELOG*
    path /LICENSE*

    # 隐藏文件
    path /.*

    # 常见攻击路径
    path /admin/*
    path /administrator/*
    path /phpmyadmin/*
    path /mysql/*
    path /db/*
    path /database/*
    path /backup/*
    path /uploads/*

    # 开发工具路径
    path /_ignition/*
    path /debug/*
    path /phpinfo*
    path /test*
    path /demo*
}

# 匹配到敏感路径时，立即返回 403 Forbidden 并中止请求
abort @deny_sensitive 403

# 额外的安全头配置
# 针对敏感文件访问的特殊安全头配置
# 这些配置比常规安全头更严格，专门用于阻止敏感文件访问
header @deny_sensitive {
    # 防止点击劫持 - 使用最严格的 DENY 策略
    X-Frame-Options "DENY"
    # 完全阻止任何内容加载 - 针对敏感文件的最严格 CSP
    Content-Security-Policy "default-src 'none'"
    # 确保敏感文件响应不被缓存
    Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
}

# 记录被阻止的访问尝试（可选，用于安全审计）
# log @deny_sensitive {
#     level info
# }
