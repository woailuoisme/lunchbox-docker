handle_errors {
	# 1. 匹配 400 到 599 范围内的状态码
	@errors expression {http.error.status_code} >= 400

	# 2. 内部重写请求到根路径
	rewrite @errors /

	# 3. 反向代理到 tarampampam/error-pages 服务
	reverse_proxy error_pages_service:8080 {
		# 关键：通过 X-Code 传递 Caddy 捕获的原始错误码
		header_up X-Code {http.error.status_code}

		# 传递原始请求路径
		header_up X-Uri {http.request.uri}
	}
}
