# ============================================================================
# security.conf - Caddy 安全头配置片段
# ============================================================================
#
# 功能描述:
# - 配置 Web 应用的安全响应头
# - 增强网站的安全性，防止常见攻击
# - 符合现代 Web 安全最佳实践
# - 适用于所有 Web 应用的安全防护
# ============================================================================

header {
	# ============================================================================
	# Referrer-Policy - 引用策略控制
	# ============================================================================
	# 控制浏览器在导航到其他网站时发送的 Referer 头信息
	#
	# 选项说明:
	# - no-referrer-when-downgrade (默认):
	#   HTTPS → HTTPS: 发送完整 URL
	#   HTTPS → HTTP:  不发送 Referer
	# - strict-origin-when-cross-origin:
	#   同源请求: 发送完整 URL
	#   跨源请求: 仅发送源 (协议+域名+端口)
	# ============================================================================
	Referrer-Policy no-referrer-when-downgrade
	# Referrer-Policy "strict-origin-when-cross-origin"

	# ============================================================================
	# Strict-Transport-Security (HSTS) - HTTP 严格传输安全
	# ============================================================================
	# 强制浏览器使用 HTTPS 连接，防止 SSL 剥离攻击
	#
	# 参数说明:
	# - max-age=31536000: 有效期 1 年 (31536000 秒)
	# - includeSubDomains: 包含所有子域名
	# - preload: 包含在浏览器预加载列表中
	#
	# 注意: 一旦设置，浏览器会在指定时间内强制使用 HTTPS
	# ============================================================================
	Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

	# ============================================================================
	# X-XSS-Protection - 跨站脚本攻击防护
	# ============================================================================
	# 启用浏览器的内置 XSS 过滤器
	#
	# 参数说明:
	# - 1: 启用 XSS 过滤
	# - mode=block: 检测到 XSS 攻击时阻止页面渲染
	#
	# 注意: 现代浏览器已弃用此头，但仍为旧浏览器提供保护
	# ============================================================================
	X-Xss-Protection "1; mode=block"

	# ============================================================================
	# X-Content-Type-Options - 内容类型嗅探防护
	# ============================================================================
	# 阻止浏览器对响应内容进行 MIME 类型嗅探
	#
	# 作用:
	# - 防止浏览器忽略服务器设置的 Content-Type
	# - 避免将文本文件误执行为脚本
	# - 减少 MIME 类型混淆攻击
	# ============================================================================
	X-Content-Type-Options "nosniff"

	# ============================================================================
	# X-Frame-Options - 点击劫持防护
	# ============================================================================
	# 控制页面是否可以在框架中显示
	#
	# 选项说明:
	# - SAMEORIGIN: 只允许同源网站嵌入
	# - DENY: 完全禁止在任何框架中显示
	# - ALLOW-FROM uri: 允许指定源网站嵌入
	#
	# 应用场景: 防止点击劫持攻击
	# ============================================================================
	X-Frame-Options "SAMEORIGIN"

	# ============================================================================
	# Content-Security-Policy (CSP) - 内容安全策略
	# ============================================================================
	# 控制页面可以加载哪些资源，防止 XSS 和数据注入攻击
	#
	# 当前配置:
	# - upgrade-insecure-requests: 将所有 HTTP 请求升级为 HTTPS
	#
	# 完整 CSP 配置示例:
	# Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"
	# ============================================================================
	Content-Security-Policy "upgrade-insecure-requests"

	# ============================================================================
	# Server 头移除
	# ============================================================================
	# 隐藏服务器标识信息，减少信息泄露
	#
	# 作用:
	# - 防止攻击者获取服务器版本信息
	# - 减少针对特定服务器版本的攻击
	# - 增强服务器指纹识别的难度
	# ============================================================================
	-Server Caddy

	# ============================================================================
	# X-Powered-By 头移除
	# ============================================================================
	# 隐藏 PHP 版本信息，防止信息泄露
	#
	# 作用:
	# - 防止攻击者获取 PHP 版本信息
	# - 减少针对特定 PHP 版本的攻击
	# - 隐藏后端技术栈信息
	# ============================================================================
	-X-Powered-By

	# ============================================================================
	# Via 头移除
	# ============================================================================
	# 隐藏代理服务器信息，防止信息泄露
	#
	# 作用:
	# - 防止攻击者获取代理服务器信息
	# - 减少针对特定代理服务器的攻击
	# - 隐藏网络拓扑信息
	# ============================================================================
	-Via
}

# ============================================================================
# 可选的安全头配置 (根据需求启用)
# ============================================================================

# Permissions-Policy - 权限策略
# 控制浏览器功能的访问权限
# header Permissions-Policy "camera=(), microphone=(), geolocation=()"

# Cross-Origin-Embedder-Policy - 跨源嵌入策略
# 控制跨源资源的加载行为
# header Cross-Origin-Embedder-Policy "require-corp"

# Cross-Origin-Opener-Policy - 跨源打开者策略
# 控制窗口打开行为的跨源隔离
# header Cross-Origin-Opener-Policy "same-origin"

# Cross-Origin-Resource-Policy - 跨源资源策略
# 控制跨源资源请求
# header Cross-Origin-Resource-Policy "same-origin"
