# Authelia 认证服务配置
server {
    listen 80;
    server_name auth.jso.lol;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name auth.jso.lol;

    # 通用服务器配置
    include /etc/nginx/snippets/common-server.conf;


    set $upstream http://authelia:9091;

    location / {
        include /etc/nginx/snippets/proxy-standard.conf;
        proxy_pass $upstream;
    }

    # 新的认证端点 - 推荐使用
    location = /api/authz/auth-request {
        proxy_pass $upstream;
    }
    
    # 兼容旧端点
    location = /api/verify {
        proxy_pass $upstream;
    }

    location /api/authz/ {
        proxy_pass $upstream;
    }
}