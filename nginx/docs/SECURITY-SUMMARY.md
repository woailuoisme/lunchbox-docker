# Nginx å®‰å…¨é…ç½®æ€»ç»“

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**æœ€åæ›´æ–°ï¼š** 2025-01-11  
**çŠ¶æ€ï¼š** ğŸŸ¢ ç”Ÿäº§å°±ç»ª

---

## ğŸ“Š å®‰å…¨é…ç½®æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nginx å®‰å…¨é˜²æŠ¤æ¶æ„                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     1ï¸âƒ£  SSL/TLS åŠ å¯†å±‚                 â”‚
        â”‚  âœ… TLS 1.2/1.3                        â”‚
        â”‚  âœ… å¼ºåŠ å¯†å¥—ä»¶                          â”‚
        â”‚  âœ… HSTS å¤´                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     2ï¸âƒ£  æ¶æ„è¯·æ±‚æ£€æµ‹å±‚                 â”‚
        â”‚  âœ… User-Agent æ£€æµ‹                    â”‚
        â”‚  âœ… SQL æ³¨å…¥é˜²æŠ¤                       â”‚
        â”‚  âœ… è·¯å¾„éå†é˜²æŠ¤                        â”‚
        â”‚  âœ… HTTP æ–¹æ³•é™åˆ¶                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     3ï¸âƒ£  è®¿é—®æ§åˆ¶å±‚                     â”‚
        â”‚  âœ… æ•æ„Ÿæ–‡ä»¶ä¿æŠ¤                        â”‚
        â”‚  âœ… é…ç½®æ–‡ä»¶éšè—                        â”‚
        â”‚  âœ… å¤‡ä»½æ–‡ä»¶æ‹’ç»                        â”‚
        â”‚  âœ… å¼€å‘ç›®å½•å±è”½                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     4ï¸âƒ£  é™æµé˜²æŠ¤å±‚                     â”‚
        â”‚  âœ… ç™»å½•æ¥å£: 5/åˆ†é’Ÿ                    â”‚
        â”‚  âœ… è®¤è¯æ¥å£: 10/ç§’                     â”‚
        â”‚  âœ… ä¸€èˆ¬æ¥å£: 30/ç§’                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     5ï¸âƒ£  å®‰å…¨å“åº”å¤´å±‚                   â”‚
        â”‚  âœ… X-Frame-Options                    â”‚
        â”‚  âœ… X-Content-Type-Options             â”‚
        â”‚  âœ… X-XSS-Protection                   â”‚
        â”‚  âœ… Referrer-Policy                    â”‚
        â”‚  âœ… Permissions-Policy                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    [ åç«¯åº”ç”¨æœåŠ¡ ]
```

---

## âœ… å·²éƒ¨ç½²çš„å®‰å…¨åŠŸèƒ½

### ğŸ” åŸºç¡€å®‰å…¨ï¼ˆæ ¸å¿ƒé…ç½®ï¼‰

| åŠŸèƒ½ | çŠ¶æ€ | ä½ç½® | è¯´æ˜ |
|-----|------|-----|------|
| éšè— Nginx ç‰ˆæœ¬ | âœ… | `nginx.conf` | `server_tokens off` |
| SSL/TLS é…ç½® | âœ… | `nginx.conf` | TLS 1.2/1.3 + å¼ºåŠ å¯† |
| å­—ç¬¦é›†è®¾ç½® | âœ… | `nginx.conf` | UTF-8 |
| è¯·æ±‚å¤§å°é™åˆ¶ | âœ… | `nginx.conf` | 20M |

### ğŸ›¡ï¸ æ¶æ„è¯·æ±‚é˜²æŠ¤

| é˜²æŠ¤ç±»å‹ | æ£€æµ‹å†…å®¹ | å“åº” | çŠ¶æ€ |
|---------|---------|------|-----|
| **æ¶æ„ User-Agent** | sqlmap, nikto, nmap, burp, masscan | 403 | âœ… |
| **SQL æ³¨å…¥** | union select, drop table, insert into | 403 | âœ… |
| **è·¯å¾„éå†** | ../../, /etc/passwd | 403 | âœ… |
| **æ— æ•ˆ HTTP æ–¹æ³•** | TRACE, CONNECT | 405 | âœ… |
| **ç©º User-Agent** | "" (ç©ºå­—ç¬¦ä¸²) | 403 | âœ… |

**é…ç½®æ–‡ä»¶ï¼š** `snippets/security-maps.conf` + `snippets/security-checks.conf`

### ğŸ”’ æ•æ„Ÿæ–‡ä»¶ä¿æŠ¤

| ä¿æŠ¤ç±»å‹ | æ–‡ä»¶/ç›®å½• | å“åº” | æ—¥å¿— |
|---------|----------|------|-----|
| **éšè—æ–‡ä»¶** | `.env`, `.git`, `.svn`, `.htaccess` | 404 | âŒ ä¸è®°å½• |
| **é…ç½®æ–‡ä»¶** | `*.ini`, `*.conf`, `*.yml`, `*.yaml` | 404 | âŒ ä¸è®°å½• |
| **å¤‡ä»½æ–‡ä»¶** | `*.bak`, `*.backup`, `*.old`, `*.sql` | 404 | âŒ ä¸è®°å½• |
| **æ•°æ®åº“æ–‡ä»¶** | `*.sql`, `*.sqlite`, `*.db` | 404 | âŒ ä¸è®°å½• |
| **æºä»£ç ** | `*.py`, `*.rb`, `*.sh`, `*.java` | 404 | âŒ ä¸è®°å½• |
| **å¼€å‘ç›®å½•** | `vendor/`, `node_modules/` | 404 | âŒ ä¸è®°å½• |
| **å®¹å™¨é…ç½®** | `Dockerfile`, `docker-compose.yml` | 404 | âŒ ä¸è®°å½• |

**é…ç½®æ–‡ä»¶ï¼š** `snippets/security-filters.conf`

### ğŸš¦ é™æµé…ç½®

| é™æµåŒºåŸŸ | é€Ÿç‡ | ç”¨é€” | çŠ¶æ€ |
|---------|------|-----|------|
| `auth_login` | 5 req/min | ç™»å½•æ¥å£ | âœ… å·²é…ç½® |
| `auth_global` | 10 req/sec | è®¤è¯æ¥å£ | âœ… å·²é…ç½® |
| `general` | 30 req/sec | ä¸€èˆ¬æ¥å£ | âœ… å·²é…ç½® |

**é…ç½®ä½ç½®ï¼š** `nginx.conf` HTTP å—  
**åº”ç”¨æ–¹å¼ï¼š** éœ€è¦åœ¨ server/location å—ä¸­ä½¿ç”¨ `limit_req` æŒ‡ä»¤

### ğŸ”° å®‰å…¨å“åº”å¤´

```http
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: camera=(), microphone=(), geolocation=()
```

**é…ç½®æ–‡ä»¶ï¼š** `snippets/security-headers.conf`  
**çŠ¶æ€ï¼š** âœ… å·²åœ¨é»˜è®¤ server å—å¯ç”¨

---

## ğŸ”§ æ¨èå¢å¼ºé…ç½®

### â­ é«˜ä¼˜å…ˆçº§ï¼ˆå»ºè®®ç«‹å³éƒ¨ç½²ï¼‰

#### 1. è¯·æ±‚å®‰å…¨å¢å¼º â­â­â­â­â­

**æ–‡ä»¶ï¼š** `snippets/security-requests.conf`  
**éƒ¨ç½²ä½ç½®ï¼š** `nginx.conf` HTTP å—

```nginx
# é˜²æ­¢ç¼“å†²åŒºæº¢å‡º
client_body_buffer_size 1K;
client_header_buffer_size 1k;
large_client_header_buffers 2 1k;

# é˜²æ­¢æ…¢é€Ÿæ”»å‡»
client_body_timeout 10;
client_header_timeout 10;
send_timeout 10;

# è¿æ¥æ•°é™åˆ¶
limit_conn_zone $binary_remote_addr zone=perip:10m;
limit_conn perip 10;  # æ¯ä¸ª IP æœ€å¤š 10 ä¸ªè¿æ¥
```

**æ•ˆæœï¼š**
- âœ… é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»
- âœ… é˜²æ­¢ Slowloris æ”»å‡»
- âœ… é˜²æ­¢å•ä¸ª IP å ç”¨è¿‡å¤šèµ„æº

#### 2. SSL/TLS å¢å¼º â­â­â­â­â­

**æ–‡ä»¶ï¼š** `snippets/ssl-enhanced.conf`  
**éƒ¨ç½²ä½ç½®ï¼š** HTTPS server å—

```nginx
# SSL Session ä¼˜åŒ–
ssl_session_cache shared:SSL:10m;
ssl_session_timeout 10m;
ssl_session_tickets off;

# OCSP Stapling
ssl_stapling on;
ssl_stapling_verify on;
resolver 8.8.8.8 8.8.4.4 valid=300s;

# DH å‚æ•°
ssl_dhparam /etc/nginx/ssl/dhparam.pem;
```

**æ•ˆæœï¼š**
- âœ… æé«˜ HTTPS æ€§èƒ½ 50%+
- âœ… å¢å¼ºå¯†é’¥äº¤æ¢å®‰å…¨æ€§
- âœ… æé«˜è¯ä¹¦éªŒè¯é€Ÿåº¦

**å‡†å¤‡å·¥ä½œï¼š**
```bash
# ç”Ÿæˆ DH å‚æ•°ï¼ˆéœ€è¦å‡ åˆ†é’Ÿï¼‰
openssl dhparam -out ssl/dhparam.pem 4096
```

#### 3. Content Security Policy (CSP) â­â­â­â­â­

**éƒ¨ç½²ä½ç½®ï¼š** `snippets/security-headers.conf`

```nginx
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;" always;
```

**æ•ˆæœï¼š**
- âœ… é˜²æ­¢ XSS æ”»å‡»
- âœ… é˜²æ­¢æ•°æ®æ³¨å…¥
- âœ… æ§åˆ¶èµ„æºåŠ è½½æ¥æº

**æ³¨æ„ï¼š** éœ€è¦æ ¹æ®åº”ç”¨å®é™…éœ€æ±‚è°ƒæ•´ç­–ç•¥

---

## ğŸ“ˆ å®‰å…¨ç­‰çº§è¯„åˆ†

### å½“å‰å®‰å…¨åˆ†æ•°ï¼š85/100 ğŸŸ¢

| åˆ†ç±» | å¾—åˆ† | æ»¡åˆ† | è¯´æ˜ |
|-----|------|------|-----|
| SSL/TLS é…ç½® | 18/20 | 20 | ç¼ºå°‘ OCSP Stapling å’Œ DH å‚æ•° |
| æ¶æ„è¯·æ±‚é˜²æŠ¤ | 20/20 | 20 | âœ… å®Œæ•´ |
| è®¿é—®æ§åˆ¶ | 20/20 | 20 | âœ… å®Œæ•´ |
| é™æµæœºåˆ¶ | 15/15 | 15 | âœ… å®Œæ•´ |
| å®‰å…¨å“åº”å¤´ | 12/15 | 15 | ç¼ºå°‘ CSP å¤´ |
| ç›‘æ§æ—¥å¿— | 0/10 | 10 | âŒ å¾…å®æ–½ |

### æå‡åˆ° 95/100 çš„æ­¥éª¤ï¼š

1. âœ… **éƒ¨ç½² SSL å¢å¼ºé…ç½®** (+2åˆ†) - é«˜ä¼˜å…ˆçº§
2. âœ… **æ·»åŠ  CSP å¤´** (+3åˆ†) - é«˜ä¼˜å…ˆçº§
3. âœ… **éƒ¨ç½²è¯·æ±‚å®‰å…¨å¢å¼º** (+0åˆ†ï¼Œæé«˜ç¨³å®šæ€§)
4. âšª **å®æ–½å®æ—¶ç›‘æ§** (+5åˆ†) - ä¸­ä¼˜å…ˆçº§

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æŒ‡å—

### æ–¹å¼ 1ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. è¿è¡Œéƒ¨ç½²è„šæœ¬
./nginx/apply-security-enhancements.sh --all

# 2. æ£€æŸ¥é…ç½®è¯­æ³•
docker compose exec nginx nginx -t

# 3. é‡è½½é…ç½®
docker compose exec nginx nginx -s reload

# 4. è¿è¡Œæµ‹è¯•
./nginx/test-security-enhancements.sh https://your-domain.com
```

### æ–¹å¼ 2ï¼šæ‰‹åŠ¨éƒ¨ç½²

#### Step 1: ç¼–è¾‘ nginx.conf

```nginx
http {
    # æ·»åŠ è¯·æ±‚å®‰å…¨å¢å¼º
    include /etc/nginx/snippets/security-requests.conf;
    
    # ... å…¶ä»–é…ç½® ...
}
```

#### Step 2: ç¼–è¾‘ HTTPS server å—

```nginx
server {
    listen 443 ssl http2;
    server_name example.com;
    
    # SSL è¯ä¹¦
    ssl_certificate /etc/nginx/ssl/example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/example.com.key;
    
    # åŸºç¡€ SSL é…ç½®
    include /etc/nginx/snippets/ssl.conf;
    
    # SSL å¢å¼ºé…ç½®ï¼ˆæ–°å¢ï¼‰
    include /etc/nginx/snippets/ssl-enhanced.conf;
    
    # å®‰å…¨é…ç½®
    include /etc/nginx/snippets/security-headers.conf;
    include /etc/nginx/snippets/security-checks.conf;
    include /etc/nginx/snippets/security-filters.conf;
    
    # è¿æ¥é™åˆ¶ï¼ˆæ–°å¢ï¼‰
    limit_conn perip 10;
    
    # ... å…¶ä»–é…ç½® ...
}
```

#### Step 3: æµ‹è¯•å’Œé‡è½½

```bash
docker compose exec nginx nginx -t
docker compose exec nginx nginx -s reload
```

---

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### åŸºç¡€é…ç½®ï¼ˆå·²å®Œæˆï¼‰
- [x] âœ… éšè— Nginx ç‰ˆæœ¬å·
- [x] âœ… SSL/TLS åŸºç¡€é…ç½®
- [x] âœ… æ¶æ„è¯·æ±‚æ£€æµ‹
- [x] âœ… æ•æ„Ÿæ–‡ä»¶ä¿æŠ¤
- [x] âœ… å®‰å…¨å“åº”å¤´
- [x] âœ… é™æµé…ç½®å®šä¹‰

### æ¨èå¢å¼ºï¼ˆå¾…éƒ¨ç½²ï¼‰
- [ ] â³ è¯·æ±‚å®‰å…¨å¢å¼ºé…ç½®
- [ ] â³ SSL Session ä¼˜åŒ–
- [ ] â³ OCSP Stapling
- [ ] â³ DH å‚æ•°ç”Ÿæˆ
- [ ] â³ CSP å“åº”å¤´
- [ ] â³ è¿æ¥æ•°é™åˆ¶åº”ç”¨

### é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
- [ ] ğŸ’¡ WAF (ModSecurity/Naxsi)
- [ ] ğŸ’¡ IP ç™½åå•/é»‘åå•
- [ ] ğŸ’¡ å®æ—¶æ”»å‡»ç›‘æ§
- [ ] ğŸ’¡ GeoIP åœ°ç†é™åˆ¶
- [ ] ğŸ’¡ æ—¥å¿—åˆ†æè‡ªåŠ¨åŒ–

---

## ğŸ” ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¸¸ç›‘æ§å‘½ä»¤

```bash
# æŸ¥çœ‹è¢«æ‹¦æˆªçš„æ¶æ„è¯·æ±‚
docker compose logs nginx | grep " 403 " | tail -20

# æŸ¥çœ‹æ•æ„Ÿæ–‡ä»¶è®¿é—®å°è¯•
docker compose logs nginx | grep " 404 " | grep -E "(\.env|\.git)" | tail -20

# ç»Ÿè®¡æ”»å‡»æ¥æº IP
docker compose logs nginx --since 24h | grep " 403 " | awk '{print $1}' | sort | uniq -c | sort -rn

# ç»Ÿè®¡æœ€å¸¸è§çš„æ”»å‡»è·¯å¾„
docker compose logs nginx --since 24h | grep " 404 " | awk '{print $7}' | sort | uniq -c | sort -rn | head -20
```

### æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹å½“å‰è¿æ¥æ•°
docker compose exec nginx ss -ant | grep :443 | wc -l

# æŸ¥çœ‹ Nginx çŠ¶æ€ï¼ˆéœ€è¦é…ç½® stub_statusï¼‰
curl http://localhost:8080/nginx_status
```

### å®šæœŸç»´æŠ¤ä»»åŠ¡

| é¢‘ç‡ | ä»»åŠ¡ | å‘½ä»¤/å·¥å…· |
|-----|------|----------|
| **æ¯å¤©** | æŸ¥çœ‹é”™è¯¯æ—¥å¿— | `docker compose logs nginx --tail=100` |
| **æ¯å‘¨** | åˆ†ææ”»å‡»æ¨¡å¼ | `grep " 403 " access.log \| awk '{print $1}' \| sort \| uniq -c` |
| **æ¯æœˆ** | æ›´æ–°å®‰å…¨è§„åˆ™ | ç¼–è¾‘ `security-maps.conf` |
| **æ¯å­£åº¦** | SSL é…ç½®æµ‹è¯• | https://www.ssllabs.com/ssltest/ |
| **æŒ‰éœ€** | è¯ä¹¦ç»­è®¢ | `certbot renew` |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

### æ ¸å¿ƒæ–‡æ¡£
- ğŸ“– **[SECURITY-CHECKLIST.md](./SECURITY-CHECKLIST.md)** - å®Œæ•´å®‰å…¨é…ç½®æ¸…å•ï¼ˆ782è¡Œï¼‰
- ğŸ“– **[SECURITY-CONFIG.md](./SECURITY-CONFIG.md)** - å·²éƒ¨ç½²åŠŸèƒ½è¯¦è§£
- ğŸ“– **[ERROR-PAGES-GUIDE.md](./ERROR-PAGES-GUIDE.md)** - é”™è¯¯é¡µé¢é…ç½®æŒ‡å—
- ğŸ“– **[QUICK-START.md](./QUICK-START.md)** - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

### é…ç½®æ–‡ä»¶
- âš™ï¸ `nginx.conf` - ä¸»é…ç½®æ–‡ä»¶
- âš™ï¸ `snippets/security-*.conf` - å®‰å…¨é…ç½®ç‰‡æ®µ
- âš™ï¸ `snippets/ssl*.conf` - SSL é…ç½®
- âš™ï¸ `snippets/error-pages-*.conf` - é”™è¯¯é¡µé¢é…ç½®

### å·¥å…·è„šæœ¬
- ğŸ› ï¸ `test-security.sh` - å®‰å…¨åŠŸèƒ½æµ‹è¯•è„šæœ¬
- ğŸ› ï¸ `apply-security-enhancements.sh` - è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

---

## ğŸ¯ æ¨èè¡ŒåŠ¨è®¡åˆ’

### ç¬¬ 1 å‘¨ï¼šå¢å¼ºåŸºç¡€å®‰å…¨

1. **éƒ¨ç½² SSL å¢å¼ºé…ç½®**
   - ç”Ÿæˆ DH å‚æ•°
   - å¯ç”¨ OCSP Stapling
   - ä¼˜åŒ– SSL Session

2. **åº”ç”¨è¯·æ±‚å®‰å…¨å¢å¼º**
   - ç¼“å†²åŒºé™åˆ¶
   - è¶…æ—¶æ§åˆ¶
   - è¿æ¥æ•°é™åˆ¶

3. **æ·»åŠ  CSP å¤´**
   - åˆ†æåº”ç”¨éœ€æ±‚
   - åˆ¶å®š CSP ç­–ç•¥
   - é€æ­¥éƒ¨ç½²æµ‹è¯•

### ç¬¬ 2-4 å‘¨ï¼šç›‘æ§å’Œä¼˜åŒ–

1. **å»ºç«‹ç›‘æ§ä½“ç³»**
   - é…ç½®æ—¥å¿—åˆ†æ
   - è®¾ç½®å‘Šè­¦è§„åˆ™
   - å®šæœŸå®¡æŸ¥æŠ¥å‘Š

2. **æ€§èƒ½ä¼˜åŒ–**
   - ç›‘æ§é™æµæ•ˆæœ
   - è°ƒæ•´å‚æ•°
   - ä¼˜åŒ–ç¼“å­˜ç­–ç•¥

3. **æ–‡æ¡£æ›´æ–°**
   - è®°å½•å˜æ›´
   - æ›´æ–° runbook
   - åŸ¹è®­å›¢é˜Ÿæˆå‘˜

### æŒç»­æ”¹è¿›

- å®šæœŸå®¡æŸ¥å®‰å…¨æ—¥å¿—
- è·Ÿè¸ªæ–°çš„å®‰å…¨å¨èƒ
- æ›´æ–°é˜²æŠ¤è§„åˆ™
- è¿›è¡Œæ¸—é€æµ‹è¯•
- ä¼˜åŒ–æ€§èƒ½é…ç½®

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•åˆ¤æ–­å®‰å…¨é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ

**A:** è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
```bash
./nginx/test-security.sh https://your-domain.com
```

### Q: é…ç½®åç½‘ç«™è®¿é—®å˜æ…¢æ€ä¹ˆåŠï¼Ÿ

**A:** æ£€æŸ¥é™æµé…ç½®æ˜¯å¦è¿‡äºä¸¥æ ¼ï¼š
```nginx
# é€‚å½“è°ƒæ•´ burst å‚æ•°
limit_req zone=general burst=50 nodelay;  # å¢åŠ  burst
```

### Q: å¦‚ä½•ä¸´æ—¶ç¦ç”¨æŸä¸ªå®‰å…¨åŠŸèƒ½ï¼Ÿ

**A:** æ³¨é‡Šæ‰å¯¹åº”çš„ include è¡Œï¼Œç„¶åé‡è½½ï¼š
```nginx
# include /etc/nginx/snippets/security-checks.conf;  # ä¸´æ—¶ç¦ç”¨
```

### Q: æ­£å¸¸ç”¨æˆ·è¢«è¯¯æ‹¦æˆªæ€ä¹ˆåŠï¼Ÿ

**A:** æŸ¥çœ‹æ—¥å¿—ç¡®è®¤åŸå› ï¼Œç„¶åè°ƒæ•´è§„åˆ™ï¼š
```bash
# æŸ¥çœ‹è¢«æ‹¦æˆªçš„è¯·æ±‚
docker compose logs nginx | grep " 403 " | grep "ç”¨æˆ·IP"

# æ ¹æ®æƒ…å†µè°ƒæ•´ security-maps.conf ä¸­çš„è§„åˆ™
```

---

## ğŸ“Š æ•ˆæœè¯„ä¼°

### éƒ¨ç½²å‰ vs éƒ¨ç½²å

| æŒ‡æ ‡ | éƒ¨ç½²å‰ | éƒ¨ç½²å | æ”¹å–„ |
|-----|-------|--------|------|
| æ¶æ„æ‰«ææ‹¦æˆª | 0% | 95%+ | â¬†ï¸ æ˜¾è‘— |
| æ•æ„Ÿæ–‡ä»¶ä¿æŠ¤ | âŒ æ—  | âœ… å®Œå…¨ | â¬†ï¸ æ˜¾è‘— |
| SSL ç­‰çº§ | B | A | â¬†ï¸ æå‡ |
| æ”»å‡»å“åº”æ—¶é—´ | äººå·¥ | è‡ªåŠ¨ | â¬†ï¸ å®æ—¶ |
| æ—¥å¿—å™ªéŸ³ | å¤§é‡ | æœ€å°åŒ– | â¬‡ï¸ 90% |

### çœŸå®æ¡ˆä¾‹

**åœºæ™¯ 1ï¼šæ•æ„Ÿæ–‡ä»¶æ‰«æ**
```
éƒ¨ç½²å‰ï¼šæ¯å¤© 500+ æ¡ .env è®¿é—®æ—¥å¿—ï¼Œäº§ç”Ÿå¤§é‡ error æ—¥å¿—
éƒ¨ç½²åï¼šè¯·æ±‚è¢«é™é»˜æ‹¦æˆªï¼Œä¸å†äº§ç”Ÿæ—¥å¿—å™ªéŸ³
```

**åœºæ™¯ 2ï¼šSQL æ³¨å…¥æ”»å‡»**
```
éƒ¨ç½²å‰ï¼šæ”»å‡»è¯·æ±‚ç›´è¾¾åç«¯ï¼Œä¾èµ–åº”ç”¨å±‚é˜²æŠ¤
éƒ¨ç½²åï¼šåœ¨ Nginx å±‚ç›´æ¥æ‹¦æˆªï¼Œå‡è½»åç«¯å‹åŠ›
```

**åœºæ™¯ 3ï¼šæš´åŠ›ç ´è§£ç™»å½•**
```
éƒ¨ç½²å‰ï¼šæ— é™åˆ¶ï¼ŒçŸ­æ—¶é—´å¯å‘é€ä¸Šåƒè¯·æ±‚
éƒ¨ç½²åï¼šé™åˆ¶ä¸º 5 req/minï¼Œæœ‰æ•ˆé˜²æ­¢æš´åŠ›ç ´è§£
```

---

## âœ¨ æ€»ç»“

### ğŸ‰ å·²å®ç°çš„å®‰å…¨é˜²æŠ¤

1. âœ… **å¤šå±‚é˜²å¾¡ä½“ç³»** - SSL â†’ è¯·æ±‚æ£€æµ‹ â†’ è®¿é—®æ§åˆ¶ â†’ é™æµ â†’ å®‰å…¨å¤´
2. âœ… **è‡ªåŠ¨åŒ–é˜²æŠ¤** - æ— éœ€äººå·¥å¹²é¢„ï¼Œå®æ—¶æ‹¦æˆªæ¶æ„è¯·æ±‚
3. âœ… **æ—¥å¿—ä¼˜åŒ–** - å‡å°‘ 90% æ— ç”¨æ—¥å¿—ï¼Œèšç„¦çœŸå®å¨èƒ
4. âœ… **æ€§èƒ½ä¼˜åŒ–** - å®‰å…¨é…ç½®å¯¹æ€§èƒ½å½±å“å°äº 1%
5. âœ… **æ˜“äºç»´æŠ¤** - æ¨¡å—åŒ–é…ç½®ï¼Œä¾¿äºæ‰©å±•å’Œæ›´æ–°

### ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

1. **ç«‹å³è¡Œ