# Redis TCP 代理配置
# 定义日志格式
log_format redis_basic '$remote_addr [$time_local] '
                       '$protocol $status $bytes_sent $bytes_received '
                       '$session_time';

# 后端连接池配置
upstream redis_backend {
    server redis:6379;  # Redis 容器名:端口
    # 可选：添加多个 Redis 实例实现负载均衡或主从复制
    # server redis-replica:6379 backup;
    # server redis-sentinel:26379 backup;
}

# Redis TCP 代理
server {
    listen 46379;  # Nginx 监听端口（外部访问）
    proxy_pass redis_backend;

    # 超时设置 - Redis 通常需要较短的超时
    proxy_connect_timeout 5s;
    proxy_timeout 60s;  # Redis 操作通常很快

    # 日志输出到前台（Docker 容器日志）
    access_log /dev/stdout redis_basic;
    error_log /dev/stderr;
}

# 可选：Redis Sentinel 代理（如果需要）
# server {
#     listen 26379;
#     proxy_pass redis_sentinel_backend;
#     proxy_connect_timeout 3s;
#     proxy_timeout 30s;
#     access_log /dev/stdout redis_basic;
#     error_log /dev/stderr;
# }
