# 错误页面配置 - 完整版（向后兼容）
# 此文件包含完整的错误页面配置，可以直接在 server 块中引入
#
# 推荐用法：
# 1. 如需全局配置（推荐）：
#    - 在 http {} 块引入: error-pages-global.conf
#    - 在 server {} 块引入: error-pages-location.conf
#
# 2. 如需单个 server 配置（简单）：
#    - 在 server {} 块引入: error-pages.conf（本文件）

# 将所有 4xx 和 5xx 错误码统一代理到 error-pages 服务
error_page 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 421 422 423 424 425 426 428 429 431 451 /error-pages/$status;
error_page 500 501 502 503 504 505 506 507 508 510 511 /error-pages/$status;

# 代理到 error-pages 服务（容器名:端口）
location /error-pages/ {
    # 禁止缓存错误页面
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";

    # 转发到 error-pages 容器（Docker 网络内部访问）
    proxy_pass http://error-pages:8080/$status;  # error-pages 默认端口 8080
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # 仅内部访问，禁止外部直接请求 /error-pages/ 路径
    internal;
}
