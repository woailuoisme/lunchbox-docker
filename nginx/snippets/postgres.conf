# PostgreSQL TCP 代理配置
# 定义日志格式
log_format basic '$remote_addr [$time_local] '
                 '$protocol $status $bytes_sent $bytes_received '
                 '$session_time';

# 后端连接池配置
upstream postgres_backend {
    server postgres:5432;  # PostgreSQL 容器名:端口
    # 可选：添加多个 PostgreSQL 实例实现负载均衡
    # server postgres-replica:5432 backup;
}

# PostgreSQL TCP 代理
server {
    listen 45432;  # Nginx 监听端口（外部访问）
    proxy_pass postgres_backend;

    # 超时设置
    proxy_connect_timeout 10s;
    proxy_timeout 30m;  # PostgreSQL 连接可能需要较长时间

    # 日志输出到前台（Docker 容器日志）
    access_log /dev/stdout basic;
    error_log /dev/stderr;
}
