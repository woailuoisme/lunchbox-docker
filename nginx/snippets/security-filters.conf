# 安全过滤配置 - 屏蔽常见恶意扫描和攻击
# 优化版本：避免使用 if 指令，使用更安全的 location 块

# 1. 屏蔽敏感文件访问 - 所有隐藏文件（以 . 开头）
location ~ /\. {
    # 禁止访问：.env, .git, .svn, .htaccess, .DS_Store 等
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 2. 屏蔽版本控制目录
location ~ ^/\.(git|svn|hg|bzr) {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 3. 屏蔽备份文件和临时文件
location ~ \.(bak|backup|old|orig|save|swp|swo|tmp|temp|cache|~|log)$ {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 4. 屏蔽常见配置文件扩展名
location ~ \.(ini|conf|cnf|yml|yaml|toml|env|config)$ {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 5. 屏蔽数据库相关文件
location ~ \.(sql|sqlite|db|mdb)$ {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 6. 屏蔽开发依赖目录
location ~ ^/(vendor|node_modules|bower_components|\.npm|\.composer|\.cargo)/ {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 7. 屏蔽包管理配置文件
location ~ ^/(composer\.(json|lock)|package(-lock)?\.json|yarn\.lock|Gemfile(\.lock)?|requirements\.txt|Cargo\.(toml|lock))$ {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 8. 屏蔽容器配置文件
location ~ ^/(Dockerfile|docker-compose\.ya?ml|\.dockerignore)$ {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 9. 屏蔽 CI/CD 配置
location ~ ^/\.(github|gitlab-ci\.yml|travis\.yml|circleci|jenkins)/ {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 10. 屏蔽常见后台管理路径（如果不需要）
location ~ ^/(phpmyadmin|pma|adminer|phpminiadmin|mysql|myadmin)/ {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 11. 屏蔽 WordPress 扫描路径（如果不是 WordPress 站点）
location ~ ^/(wp-admin|wp-login\.php|wp-config\.php|xmlrpc\.php) {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 12. 屏蔽源代码文件
location ~ \.(py|rb|pl|sh|bash|java|class|jar)$ {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 13. 屏蔽 README 和文档文件（可选，根据需求启用）
# location ~ ^/(README|CHANGELOG|LICENSE|CONTRIBUTING|AUTHORS)\.(md|txt)$ {
#     deny all;
#     access_log off;
#     log_not_found off;
#     return 404;
# }

# 14. 屏蔽探测常见漏洞的路径
location ~ ^/(console|api/v1/pods|actuator|jolokia|hawtio)/ {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# 15. 屏蔽常见测试文件和目录
location ~ ^/(test|tests|spec|specs|debug|phpinfo\.php|info\.php)/ {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}
