# Traefik 3.5.4 配置文件
# 适配 Lunchbox 项目 - 支持本地和 Let's Encrypt 证书源

# API 配置
api:
  dashboard: true
  insecure: false

# 全局配置
global:
  checkNewVersion: false
  sendAnonymousUsage: false

# 日志配置
log:
  level: INFO
  format: common

# 指标监控配置
metrics:
  prometheus:
    entryPoint: metrics

# 入口点配置
entryPoints:
  # HTTP 入口点
  web:
    address: ":80"
    http:
      redirections:
        entryPoint:
          to: websecure
          scheme: https

  # HTTPS 入口点
  websecure:
    address: ":443"

  # 监控指标入口点
  metrics:
    address: ":8082"

  # 数据库服务入口点
  postgres:
    address: ":5432"
  redis:
    address: ":6379"

# 服务发现提供者配置
providers:
  # Docker 提供者
  docker:
    endpoint: "unix:///var/run/docker.sock"
    exposedByDefault: false

  # 文件提供者
  file:
    directory: /config
    watch: true

# Ping 健康检查端点
ping:
  entryPoint: web

# TLS 证书配置 - 支持本地和 Let's Encrypt
tls:
  # 证书存储配置
  stores:
    # 本地证书存储（开发环境）
    local:
      defaultCertificate:
        certFile: /config/certs/localhost.crt
        keyFile: /config/certs/localhost.key

    # Let's Encrypt 存储（生产环境）
    letsencrypt:
      defaultGeneratedCert:
        resolver: letsencrypt
        domain:
          main: "*.jso.lol"

  # 证书解析器配置
  certificates:
    # 本地开发证书
    - certFile: /config/certs/localhost.crt
      keyFile: /config/certs/localhost.key
      stores:
        - local

  # ACME 配置 (Let's Encrypt)
  certificatesResolvers:
    # Let's Encrypt 生产环境
    letsencrypt:
      acme:
        email: "admin@yourdomain.com"
        storage: /config/acme.json
        # HTTP 挑战
        httpChallenge:
          entryPoint: web
        # 或者使用 DNS 挑战（推荐用于生产）
        # dnsChallenge:
        #   provider: cloudflare
        #   delayBeforeCheck: 0
