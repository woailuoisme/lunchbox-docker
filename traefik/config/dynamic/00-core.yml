# 核心服务配置
# 文件: traefik/config/dynamic/00-core.yml

http:
  # ============================================
  # Traefik Dashboard
  # ============================================
  routers:
    traefik-dashboard:
      entryPoints:
        - websecure
      rule: 'Host(`traefik.{{ env "DOMAIN" }}`)'
      service: api@internal
      middlewares:
        - admin-chain@file
      tls:
        certResolver: '{{ env "DEFAULT_CERT_RESOLVER" "default" }}'
      priority: 100

    traefik-api:
      entryPoints:
        - websecure
      rule: 'Host(`traefik.{{ env "DOMAIN" }}`) && PathPrefix(`/api`)'
      service: api@internal
      middlewares:
        - admin-chain@file
      tls:
        certResolver: '{{ env "DEFAULT_CERT_RESOLVER" "default" }}'
      priority: 101

    # Ping 健康检查
    ping:
      entryPoints:
        - web
      rule: "PathPrefix(`/ping`)"
      service: ping@internal
      priority: 200
    error-pages:
      entryPoints:
        - websecure
      rule: 'Host(`error.{{ env "DOMAIN" }}`)'
      service: error-pages
      middlewares:
        - web-chain@file
      tls:
        certResolver: '{{ env "DEFAULT_CERT_RESOLVER" "default" }}'
      priority: 80

  # ============================================
  # 错误页面服务
  # ============================================
  services:
    error-pages:
      loadBalancer:
        servers:
          - url: "http://error-pages:8080"
        passHostHeader: true
        healthCheck:
          path: /
          interval: "30s"
          timeout: "5s"


