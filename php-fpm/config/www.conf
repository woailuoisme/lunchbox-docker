; ============================================================================
; PHP-FPM 进程池配置文件
; 配置定义了一个名为 'www' 的进程池，用于处理 PHP 请求
; ============================================================================

[www]

; ============================================================================
; 网络监听配置
; ============================================================================

; 监听地址和端口
; 0.0.0.0:9000 表示监听所有网络接口的9000端口
listen = 0.0.0.0:9000

; ============================================================================
; 进程运行用户配置
; ============================================================================

; 运行用户和用户组
; 使用 www-data 用户和组运行 PHP-FPM 进程
; user = www-data
; group = www-data

; ============================================================================
; 进程管理配置
; ============================================================================

; 进程管理方式
; dynamic: 动态管理（根据负载自动调整进程数）
pm = dynamic

; 最大子进程数
; 同时运行的最大子进程数量，根据服务器性能调整
pm.max_children = 20

; 启动时创建的子进程数
; PHP-FPM 启动时创建的子进程数量
pm.start_servers = 4

; 最少空闲进程数
; 保持的最少空闲进程数量
pm.min_spare_servers = 2

; 最多空闲进程数
; 允许的最大空闲进程数量
pm.max_spare_servers = 6

; 子进程处理多少请求后重启
; 每个子进程处理指定请求数后自动重启，防止内存泄漏
pm.max_requests = 500

; ============================================================================
; 请求处理和日志配置
; ============================================================================

; 请求终止超时时间
; 单个请求的最大执行时间（与 Laravel 配置保持一致）
request_terminate_timeout = 600s

; 慢日志超时时间
; 超过此时间的请求将被记录到慢日志
request_slowlog_timeout = 5s

; 捕获工作进程输出
; yes: 捕获, no: 不捕获
catch_workers_output = yes

; 美化工作进程输出
; yes: 美化, no: 不美化
decorate_workers_output = no

; ============================================================================
; 健康检查配置
; ============================================================================

; 健康检查路径
; 通过访问 /ping 路径检查 PHP-FPM 是否正常运行
ping.path = /ping

; 健康检查响应
; 健康检查的响应内容
ping.response = pong

; 状态页面路径
; 通过访问 /status 路径查看 PHP-FPM 状态信息
pm.status_path = /status

; 访问日志格式
; %R - 远程 IP 地址
; %{%F %T}t - 时间戳 (YYYY-MM-DD HH:MM:SS)
; %m - 请求方法
; %r - 请求 URI (包含查询字符串)
; %s - 状态码
; %f - 脚本文件名
; %d - 执行时间（秒）
; %M - 内存使用（MB）
access.format = "%R - %{%F %T}t \"%m %r\" %s \"%f\" %ds %MMB"

; ============================================================================
; 日志和安全配置
; ============================================================================

; 慢日志配置
; 记录执行时间过长的请求日志
slowlog = /var/log/php-fpm/slow.log

; 错误日志配置
; 开启错误日志记录
php_admin_flag[log_errors] = on

; 错误日志输出路径
; 将错误日志输出到标准错误流
php_admin_value[error_log] = /proc/self/fd/2

; 是否清理环境变量
; no: 不清理, yes: 清理
clear_env = no

; 限制可执行的文件扩展名
; 只允许执行指定扩展名的文件
security.limit_extensions = .php .php8

; 限制文件访问范围
; 限制 PHP 脚本可以访问的目录范围
php_admin_value[open_basedir] = /var/www:/tmp
