# dnsmasq 配置文件 - Docker 本地开发环境
# 使用 .local.test 域名解析到本地服务

# 基础配置
port=53                    # 监听端口 53
domain-needed              # 只解析完整域名
bogus-priv                 # 过滤私有地址的 DNS 查询
no-resolv                  # 不使用系统 resolv.conf
no-poll                    # 不轮询 resolv.conf 文件变化
strict-order               # 严格按顺序使用上游 DNS
expand-hosts               # 扩展主机名到完整域名
cache-size=1000            # DNS 缓存记录数
local-ttl=300              # 本地记录 TTL 时间（秒）

# 日志配置
log-queries                # 记录 DNS 查询日志
log-dhcp                   # 记录 DHCP 活动日志

# 上游 DNS 服务器
server=8.8.8.8             # Google DNS 主服务器
server=8.8.4.4             # Google DNS 备用服务器
server=1.1.1.1             # Cloudflare DNS 主服务器
server=1.0.0.1             # Cloudflare DNS 备用服务器

# 本地域名解析 - 统一使用 .local.test 域名
address=/.local.test/127.0.0.1  # 通配符：所有 .local.test 域名解析到本地

# 服务域名映射
address=/auth.local.test/127.0.0.1           # Authelia 认证服务
address=/portainer.local.test/127.0.0.1      # Portainer 容器管理
address=/dozzle.local.test/127.0.0.1         # Dozzle 日志查看器
address=/xui.local.test/127.0.0.1            # 3X-UI VPN 面板
address=/search.local.test/127.0.0.1         # Meilisearch 搜索服务
address=/meilisearch.local.test/127.0.0.1    # Meilisearch 控制台
address=/minio.local.test/127.0.0.1          # MinIO 对象存储
address=/rabbitmq.local.test/127.0.0.1       # RabbitMQ 消息队列
address=/postgres.local.test/127.0.0.1       # PostgreSQL 数据库
address=/redis.local.test/127.0.0.1          # Redis 缓存
address=/php.local.test/127.0.0.1            # PHP 应用服务

address=/app.local.test/127.0.0.1            # 主应用服务
address=/www.app.local.test/127.0.0.1        # 应用服务 WWW
address=/api.local.test/127.0.0.1            # API 服务
address=/traefik.local.test/127.0.0.1        # Traefik 反向代理
address=/error.local.test/127.0.0.1          # 错误页面服务
address=/registry.local.test/127.0.0.1       # Docker 注册表

# 安全配置
stop-dns-rebind             # 阻止 DNS 重绑定攻击
rebind-localhost-ok         # 允许 localhost 重绑定
rebind-domain-ok=local.test # 允许 .local.test 域名重绑定

# 性能优化
dns-forward-max=150         # 最大并发 DNS 查询数
neg-ttl=60                  # 否定缓存 TTL（秒）
max-ttl=600                 # 最大 TTL 时间（秒）
