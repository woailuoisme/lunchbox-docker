; ============================================================================
; OPcache 字节码缓存配置 - 生产环境优化
; ============================================================================

; 启用 OPcache
opcache.enable=1

; 启用 CLI 模式的 OPcache（对于 artisan 命令优化）
opcache.enable_cli=1

; JIT 配置
opcache.jit=tracing
opcache.jit_buffer_size=256M

; OPcache 内存大小（MB）- 根据应用大小调整
opcache.memory_consumption=256

; 是否在缓存键中包含脚本文件的工作目录路径
; 0: 不包含, 1: 包含
opcache.use_cwd=1

; 缓存文件的最大大小（字节）
; 0 表示无限制
opcache.max_file_size=0

; 最大缓存文件数 - 根据项目文件数量调整
opcache.max_accelerated_files=40000

; 是否验证脚本时间戳
; 1: 验证, 0: 不验证（生产环境建议不验证）
opcache.validate_timestamps=0
; opcache.validate_timestamps=1

; 检查脚本时间戳的频率（秒）
; 0 表示完全禁用重新验证（生产环境推荐）
opcache.revalidate_freq=0
; opcache.revalidate_freq=2

; ============================================================================
; 高级优化配置
; ============================================================================

; 启用快速关闭（PHP 7.2+ 特性，提高性能）
opcache.fast_shutdown=1

; 启用二级字符串缓存（PHP 7.3+ 特性）
opcache.interned_strings_buffer=16

; 启用文件缓存（提高重启后的性能）
opcache.file_cache=/tmp/opcache

; 文件缓存仅限控制台使用
opcache.file_cache_only=0

; 启用文件缓存覆盖保护
opcache.file_cache_consistency_checks=1

; 内存消耗警告阈值（百分比）
opcache.max_wasted_percentage=10

; 启用预加载（PHP 7.4+ 特性）
; opcache.preload=/path/to/preload.php

; 预加载用户（如果使用预加载）
; opcache.preload_user=www-data