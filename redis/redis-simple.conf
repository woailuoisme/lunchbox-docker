# Redis 配置文件示例
#
# 启动Redis时必须将配置文件路径作为第一个参数：
# ./redis-server /path/to/redis.conf

# 单位说明：内存大小可以用以下格式指定
# 1k => 1000字节
# 1kb => 1024字节
# 1m => 1000000字节
# 1mb => 1024*1024字节
# 1g => 1000000000字节
# 1gb => 1024*1024*1024字节
# 单位不区分大小写

################################## 包含文件 ###################################

# 可以包含其他配置文件
# 适用于有标准模板但需要个性化配置的场景
#
# include /path/to/local.conf
# include /path/to/other.conf

################################## 模块加载 #####################################

# 启动时加载模块
#
# loadmodule /path/to/my_module.so
# loadmodule /path/to/other_module.so

################################## 网络配置 #####################################

# 绑定IP地址，默认监听所有网络接口
# 警告：如果服务器直接暴露在公网，绑定所有接口很危险
#
# bind 192.168.1.100 10.0.0.1
bind 127.0.0.1

# 保护模式，增强安全性
# 当未设置bind且无密码时，只允许本地连接
protected-mode yes

# 监听端口
port 6379

# TCP连接队列长度
# 需要同时调整系统somaxconn参数
tcp-backlog 511

# Unix socket配置
#
# unixsocket /tmp/redis.sock
# unixsocketperm 700

# 客户端空闲超时时间（0为禁用）
timeout 0

# TCP保活设置
tcp-keepalive 300

################################# 通用配置 #####################################

# 是否以守护进程运行
daemonize no

# 进程监督方式
supervised no

# PID文件位置
pidfile /var/run/redis_6379.pid

# 日志级别
# debug/verbose/notice/warning
loglevel notice

# 日志文件路径（空字符串输出到标准输出）
logfile ""

# 系统日志配置
# syslog-enabled no
# syslog-ident redis
# syslog-facility local0

# 数据库数量
databases 16

# 是否显示启动logo
always-show-logo yes

################################ 快照持久化 ################################
#
# 保存规则：save <秒数> <变更key数>
#
save 900 1
save 300 10
save 60 10000

# RDB保存失败时是否停止写入
stop-writes-on极bsave-error no

# RDB文件压缩
rdbcompression yes

# RDB文件校验
rdbchecksum yes

# RDB文件名
dbfilename dump.rdb

# 工作目录
dir ./

################################# 主从复制 #################################

# 主从复制配置
# replicaof <主节点IP> <主节点端口>

# 主节点密码
# masterauth <主节点密码>

# 从节点是否服务过期数据
replica-serve-stale-data yes

# 从节点只读模式
replica-read-only yes

# 无盘复制（实验性功能）
repl-diskless-sync no

# 无盘复制延迟时间
repl-diskless-sync-delay 5

# 从节点ping间隔
# repl-ping-replica-period 10

# 复制超时时间
# repl-timeout 60

# 复制禁用Nagle算法
repl-disable-tcp-nodelay no

# 复制积压缓冲区大小
# repl-backlog-size 1mb

# 复制积压缓冲区存活时间
# repl-backlog-ttl 3600

# 从节点优先级
replica-priority 100

# 最小从节点写入要求
# min-replicas-to-write 3
# min-replicas-max-lag 10

# 从节点地址宣告
# replica-announce-ip 5.5.5.5
# replica-announce-port 1234

################################## 安全配置 ##################################

# 访问密码
requirepass foobared

# 命令重命名（增强安全性）
#
# rename-command CONFIG b840fc02d524045429941cc15f59e41cb极7be6c52
# rename-command CONFIG ""

################################### 客户端限制 ####################################

# 最大客户端连接数
# maxclients 10000

############################## 内存管理 ################################

# 最大内存限制
# maxmemory <字节数>

# 内存淘汰策略
# volatile-lru -> 从过期key中淘汰最近最少使用
# allkeys-lru -> 从所有key中淘汰最近最少使用
# volatile-lfu -> 从过期key中淘汰最不经常使用
# allkeys-lfu -> 从所有key中淘汰最不经常使用
# volatile-random -> 从过期key中随机淘汰
# allkeys-random -> 从所有key中随机淘汰
# volatile-ttl -> 淘汰最快过期的key
# noeviction -> 不淘汰，返回错误
maxmemory-policy noeviction

# 淘汰采样数量
maxmemory-samples 5

# 从节点是否忽略内存限制
replica-ignore-maxmemory yes

############################# 惰性删除 ####################################

# 惰性删除配置
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy极server-del no
replica-lazy-flush no

############################## AOF持久化 ###############################

# 是否开启AOF
appendonly no

# AOF文件名
appendfilename "appendonly.aof"

# AOF同步策略
# always: 每次写入都同步
# everysec: 每秒同步（默认）
# no: 操作系统决定同步时机
appendfsync everysec

# 重写时是否禁用fsync
no-appendfsync-on-rewrite no

# AOF自动重写配置
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# 加载损坏AOF文件时的行为
aof-load-truncated yes

# AOF使用RDB前导
aof-use-rdb-preamble yes

################################ LUA脚本 ###############################

# Lua脚本执行超时时间（毫秒）
lua-time-limit 5000

################################ Redis集群 ###############################
#
# 警告：集群功能仍被认为是实验性的
#
# cluster-enabled yes
# cluster-config-file nodes-6379.conf
# cluster-node-timeout 15000
# cluster-replica-validity-factor 10
# cluster-migration-barrier 1
# cluster-require-full-coverage yes
# cluster-replica-no-failover no

########################## 集群Docker/NAT支持 ########################

# 集群节点地址宣告（用于Docker/NAT环境）
# cluster-announce-ip 10.1.1.5
# cluster-announce-port 6379
# cluster-announce-bus-port 6380

################################## 慢日志 ###################################

# 慢查询日志配置
slowlog-log-slower-than 10000
slowlog-max-len 128

################################ 延迟监控 ##############################

# 延迟监控阈值（0为禁用）
latency-monitor-threshold 0

############################# 事件通知 ##############################

# 键空间事件通知
notify-keyspace-events ""

############################### 高级配置 ###############################

# 哈希表优化配置
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# 列表优化配置
list-max-ziplist-size -2
list-compress-depth 0

# 集合优化配置
set-max极intset-entries 512

# 有序集合优化配置
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog优化配置
hll-sparse-max-bytes 3000

# 流数据优化配置
stream-node-max-bytes 4096
stream-node-max-entries 100

# 主动重哈希配置
activerehashing yes

# 客户端输出缓冲区限制
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32极mb 8mb 60

# 客户端查询缓冲区限制
# client-query-buffer-l极imit 1gb

# 批量请求大小限制
# proto-max-bulk-len 512mb

# 后台任务频率
hz 10

# 动态调整后台任务频率
dynamic-hz yes

# 增量式fsync优化
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes

# LFU淘汰算法配置
# lfu-log-factor 10
# lfu-decay-time 1

########################### 主动碎片整理 #######################
#
# 警告：此功能为实验性
#
# activedefrag yes
# active-defrag-ignore-bytes 100mb
# active-defrag-threshold-lower 10
# active-defrag-threshold-upper 100
# active-defrag-cycle-min 极5
# active-defrag-cycle-max 75
# active-defrag-max-scan-fields 1000
